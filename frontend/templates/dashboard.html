<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>{{ page_title or 'Dashboard' }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
</head>
<body>
    <header class="dash-header">
        <a class="back-link" href="{{ menu_url if menu_url is defined else url_for('login') }}" title="Volver al menú">←</a>
        <h1 class="dash-title">{{ page_title or 'Dashboard' }}</h1>
    </header>

    <main class="dash-main">
        <section class="cards">
            <article class="card">
                <h2 class="card-title">Ventas por Día (últimos 7 días)</h2>
                <div class="card-body">
                    {% if img_ventas_dia %}
                        <img class="chart" src="data:image/png;base64,{{ img_ventas_dia }}" alt="Gráfica de ventas por día" />
                    {% else %}
                        <p class="empty">No hay datos de ventas por día.</p>
                    {% endif %}
                </div>
            </article>

            <article class="card">
                <h2 class="card-title">Ventas por Semana (últimas 4 semanas)</h2>
                <div class="card-body">
                    {% if img_ventas_semana %}
                        <img class="chart" src="data:image/png;base64,{{ img_ventas_semana }}" alt="Gráfica de ventas por semana" />
                    {% else %}
                        <p class="empty">No hay datos de ventas por semana.</p>
                    {% endif %}
                </div>
            </article>

            <article class="card">
                <h2 class="card-title">Ventas por Mes (últimos 12 meses)</h2>
                <div class="card-body">
                    {% if img_ventas_mes %}
                        <img class="chart" src="data:image/png;base64,{{ img_ventas_mes }}" alt="Gráfica de ventas por mes" />
                    {% else %}
                        <p class="empty">No hay datos de ventas por mes.</p>
                    {% endif %}
                </div>
            </article>
        </section>

        <section class="cards two">
            <article class="card">
                <h2 class="card-title">Productos Bajo Stock</h2>
                <div class="card-body">
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">ID Producto</th>
                                    <th scope="col">Nombre</th>
                                    <th scope="col">Cantidad</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for p in bajo_stock|default([], true) %}
                                <tr>
                                    <td>{{ p.id_producto }}</td>
                                    <td>{{ p.nombre }}</td>
                                    <td>{{ p.cantidad }}</td>
                                </tr>
                                {% else %}
                                <tr><td colspan="3" class="empty">No hay productos bajo stock.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </article>

            <article class="card">
                <h2 class="card-title">Pedidos Activos</h2>
                <div class="card-body">
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">ID Compra</th>
                                    <th scope="col">Descripción</th>
                                    <th scope="col">Cantidad</th>
                                    <th scope="col">Estado</th>
                                    <th scope="col">Fecha Pedido</th>
                                    <th scope="col">Fecha Entrega</th>
                                    <th scope="col">Proveedor</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for pedido in pedidos|default([], true) %}
                                <tr>
                                    <td>{{ pedido.id_compra }}</td>
                                    <td>{{ pedido.descripcion }}</td>
                                    <td>{{ pedido.cantidad }}</td>
                                    <td>{{ pedido.estado|default('N/A', true) }}</td>
                                    <td>{{ pedido.fecha_pedido|default('—', true) }}</td>
                                    <td>{{ pedido.fecha_entrega|default('—', true) }}</td>
                                    <td>{{ pedido.proveedor_nombre }}</td>
                                </tr>
                                {% else %}
                                <tr><td colspan="7" class="empty">No hay pedidos activos.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </article>
        </section>
    </main>
</body>
</html>